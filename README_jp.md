# Click-qPCR ユーザーガイド

Click-qPCRは，リアルタイム定量PCR（qPCR）データ解析のために設計されたユーザーフレンドリーなShinyウェブアプリケーションです。

**このツールはウェブブラウザ（<https://kubo-azu.shinyapps.io/Click-qPCR/>）からすぐに利用でき，ローカルへのインストールが不要です。**

ユーザーはCq（定量サイクル）値を含むCSVファイルをアップロードすることで，ΔCq および ΔΔCq の計算を実行できます。個々のデータポイントを含む棒グラフとして結果を視覚化し，統計サマリーと出版品質のプロットの両方をダウンロードできます。

アプリケーションをローカルで実行または修正したいユーザーのために，ソースコードも利用可能です（下記の「インストールと使い方」セクションを参照）。

このツールは，一般的なqPCRデータ解析のワークフローを簡素化し，表計算ソフトによる煩雑な解析やプログラミングの知識なしに再現性ある解析を実行することを目的としています。

### <ins>注意</ins>

このリポジトリには，プレプリントに付随する Shiny アプリのソースコードが含まれています。

Kubota, et al. *bioRxiv*. (2025). <https://doi.org/10.1101/2025.05.29.656779>.

**このアプリやコードを研究で使用する場合は，この論文を引用してください。（学会発表や卒業研究含む）**

## 特徴

-   **インタラクティブなデータアップロード:** CSV形式のqPCRデータを簡単にアップロードできます。データフォーマットを案内するためのテンプレートが提供されています。

-   **データプレビュー:** アップロードしたデータの最初の10行を表示し, 正しく読み込まれていることを確認できます。

-   **タブベースの解析:** ユーザーインターフェースは異なる解析のためのタブに整理されています。

    -   **Analysisタブ（ΔCq法）:**
        -   リファレンス遺伝子と1つ以上のターゲット遺伝子を選択します。
        -   直感的なインターフェースを使用して，**複数のグループ比較を同時に**設定できます。
        -   相対発現量（2<sup>-ΔCq</sup>）を計算します。
        -   指定された各ペアについて，統計的有意性のためにWelchのt検定を実行します。
        -   平均±SDを示す包括的な棒グラフと，個々のデータポイントを重ねてすべての結果を視覚化します。

    -   **ΔΔCq解析タブ:**
        -   Analysisタブで選択されたリファレンス遺伝子が自動的に使用されます。
        -   ターゲット遺伝子、ベース/コントロールグループ、および1つ以上のトリートメントグループを選択します。
        -   ベースグループに対するフォールドチェンジ（2<sup>-ΔΔCq</sup>）を計算します。
        -   統計的有意性のためにWelchのt検定を実行します。
        -   専用の棒グラフで結果を視覚化します。

-   **高度なダウンロードとプロット作成:**
    -   **カスタムプロット寸法:** スライダーを使用し，ダウンロードするプロットの幅・高さ・解像度（DPI）をインタラクティブに調整できます。
    -   **固定アスペクト比:** サイズ変更中にプロットのアスペクト比をオプションでロックできます。

    -   **2つのダウンロードモード:**
        1.  **プロットのダウンロード:** カスタムの寸法とDPI設定を使用して画像を保存します。
        2.  **表示サイズの保存:** 画面に表示されているプロットと同じ画像を保存します。

-   **堅牢性:**
    -   データが不十分な場合や分散がゼロの場合でも，クラッシュすることなく適切に処理します。
    -   p-valueを計算できない場合，結果テーブルに明確なメッセージ（例：Zero variance）を提供します。

-   **診断タブ:**
    -   アプリのすべてのコア計算および統計機能が正しく動作していることを確認するために，サンプルデータに対して一連の内部チェックを実行します。

## インストールと使い方

アプリはオンラインで利用可能ですが，ローカルで実行することもできます。

### 前提条件

-   R (バージョン4.1以降を推奨)
-   以下のRパッケージ: `shiny`, `dplyr`, `ggplot2`, `tidyr`, `DT`, `RColorBrewer`, `fontawesome`

* R (バージョン 4.4.2 以降を推奨)
* RStudio (使いやすさのため推奨しますが，Rコンソールから実行する場合は必須ではありません)
* 以下のRパッケージ（およびそれらの依存パッケージ）:
    * `shiny`
    * `dplyr`
    * `ggplot2`
    * `tidyr`
    * `DT`
    * `RColorBrewer`

これらのパッケージはRで以下のようにインストールできます:

```R
install.packages(c("shiny", "dplyr", "ggplot2", "tidyr", "DT", "RColorBrewer"))
```


### アプリケーションの実行

Option 1: GitHubから直接実行

RまたはRStudio内で shiny::runGitHub() 関数を使用してGitHubから直接実行できます:

```R
if (!requireNamespace("shiny", quietly = TRUE)) install.packages("shiny")
shiny::runGitHub("kubo-azu/Click-qPCR")
```


Option 2: リポジトリをローカルにクローンする

1. このリポジトリをユーザのローカルマシン（お使いのPC）にクローンします:

```sh
git clone https://github.com/kubo-azu/Click-qPCR.git
```

2. Rでクローンしたディレクトリに移動するか，RStudioで Click-qPCR.Rproj ファイルを開きます。

3. `renv` を使用している場合（再現性のために推奨）はR環境を復元します:

```R
if (!requireNamespace("renv", quietly = TRUE)) install.packages("renv")
renv::restore()
```

4. アプリケーションを実行します:

```R
shiny::runApp()
```

## データ形式

以下の4つの列を持つCSVファイルとしてデータを準備してください。

-   `sample`: 各サンプルの一意の識別子（例：Mouse_A、CellLine_1）。
-   `group`: 実験グループまたは条件（例：Control_X、Treatment_Y）。
-   `gene`: 測定される遺伝子の名前（例：Gapdh、Actb）。
-   `Cq`: 定量サイクル値（数値）。**注:** この列の名前は`Cq`である必要があります。

各行は，1つのサンプルにおける1つの遺伝子のCq値を表す必要があります。テクニカルリプリケートがある場合，その平均値を計算して使用してください。テンプレートはアプリケーションのサイドバーからダウンロードできます。

## 使用方法

1.  **データのアップロード:** **Analysis**タブで、`Upload CSV File`または`Use Example Data`をクリックします。プレビューが表示されます。

2.  **ΔCq解析の実行（Analysis Tab）:**
    -   `Reference Gene`を選択します。
    -   1つ以上の`Target Gene(s)`を選択します。
    -   `Comparison Settings`で比較するグループのペアを定義します。
    -   `Add`をクリックして、さらに比較ペアを作成和ることも可能です。
    -   `Analyze`をクリックします。プロットと統計テーブルがメインパネルに表示されます。

3.  **ΔΔCq解析の実行（ΔΔCq Analysis Tab）:**
    -   **ΔΔCq Analysis**タブに移動します。
    -   リファレンス遺伝子はメインの解析から自動的に継承されます。
    -   単一の`Target Gene`を選択します。
    -   すべてが比較される`Base Group (Control)`を選択します。
    -   1つ以上の`Treatment Group(s)`を選択します。
    -   `Run ΔΔCq Analysis`をクリックします。フォールドチェンジのプロットとテーブルが表示されます。

4.  **結果のダウンロード:**
    -   ダウンロードボタンを使用して結果を保存します。
    -   `Download Plot`ボタンの寸法と解像度をカスタマイズするには，**Download Plot Settings**パネルを使用します。または`Save Displayed Size`を使用して画面に表示されているグラフと同じ画像ファイルをダウンロード可能です。

## サンプルデータを使用した解析例

この例では，アップレギュレーション・ダウンレギュレーション・および変化なしを示すように設計された遺伝子を含むサンプルデータ（[Click-qPCR_template.csv](Click-qPCR_template.csv)）を使用します。

### 1. サンプルデータの読み込みと解析の実行

-   `Analysis`タブで`Use Example Data`をクリックします。
-   `Comparison Settings`で`Control_X`と`Treatment_X`を比較します。
-   `Analyze`をクリックします。

選択されたすべての遺伝子とグループのバーを示すプロットが生成されます。その下のテーブルには指定された比較の統計が表示されます。

**期待されるテーブル出力（ΔCq）:** テーブルには，`gene`，`group1`，`group2`，`p_value`，`sig`の列があります。`Control_X`と`Treatment_X`の間で比較されたHoge遺伝子については，有意なp値と`sig`列に`**`が表示されるはずです。

### 2. ΔΔCq解析の実行

-   `ΔΔCq Analysis`タブに移動します。
-   `Target Gene`として`Fuga`を選択します。
-   `Base Group (Control)`として`Control_Y`を選択します。
-   `Treatment Group(s)`として`Treatment_Y`を選択します。
-   `Run ΔΔCq Analysis`をクリックします。

**期待されるテーブル出力（ΔΔCq）:** プロットには，`Control_Y`に対する`Treatment_Y`におけるFugaのフォールドチェンジが表示されます。サンプルデータに基づくと，これは1より有意に小さいフォールドチェンジ（ダウンレギュレーション）を示すはずです。テーブルには，`group1`，`group2`，`p_value`，`sig`の列があります。この比較については有意なp値が表示されます。

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています。詳細はLICENSEファイルを参照してください。
